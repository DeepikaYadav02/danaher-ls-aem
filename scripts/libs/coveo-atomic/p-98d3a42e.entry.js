import{r as t,h as e,g as s}from"./p-591772f1.js";import{P as r,T as i,U as n}from"./p-d2151deb.js";import{S as a}from"./p-cfb3c589.js";import{e as o}from"./p-9cfa1365.js";import{d as c}from"./p-ccd551fb.js";import{C as h}from"./p-c280cd05.js";import{S as l,a as u}from"./p-0e6122d5.js";import{o as p}from"./p-a5540571.js";import"./p-92adf573.js";import"./p-eab67c09.js";const d=class{constructor(e){t(this,e),this.error=void 0,this.icon=void 0,this.maxWithQuery=void 0,this.maxWithoutQuery=void 0}componentWillLoad(){try{c((e=>(this.bindings=e,this.initialize())),this.host)}catch(e){this.error=e}}renderIcon(){return this.icon||a}initialize(){const e=this.bindings.engine,{registerQuerySuggest:t,fetchQuerySuggestions:i}=r(e);return e.dispatch(t({id:this.bindings.id,count:this.bindings.numberOfQueries})),{position:Array.from(this.host.parentNode.children).indexOf(this.host),onInput:()=>e.dispatch(i({id:this.bindings.id})),renderItems:()=>this.renderItems()}}renderItems(){const e=""!==this.bindings.searchBoxController.state.value?this.maxWithQuery:this.maxWithoutQuery;return this.bindings.searchBoxController.state.suggestions.slice(0,e).map((e=>this.renderItem(e)))}renderItem(t){const i=""!==this.bindings.searchBoxController.state.value;return{part:"query-suggestion-item",content:e("div",{part:"query-suggestion-content",class:"flex items-center"},this.bindings.getSuggestions().length>1&&e("atomic-icon",{part:"query-suggestion-icon",icon:this.renderIcon(),class:"w-4 h-4 mr-2 shrink-0"}),i?e("span",{part:"query-suggestion-text",class:"break-all line-clamp-2",innerHTML:t.highlightedValue}):e("span",{part:"query-suggestion-text",class:"break-all line-clamp-2"},t.rawValue)),key:`qs-${o(t.rawValue)}`,query:t.rawValue,ariaLabel:this.bindings.i18n.t("query-suggestion-label",{query:t.rawValue,interpolation:{escapeValue:!1}}),onSelect:()=>{this.bindings.searchBoxController.selectSuggestion(t.rawValue)}}}render(){if(this.error)return e("atomic-component-error",{element:this.host,error:this.error})}get host(){return s(this)}},m=class{constructor(e){t(this,e),this.maxWithQuery=3,this.warnUser=p((()=>this.bindings.engine.logger.warn("Because analytics are disabled, the recent queries feature is deactivated."))),this.error=void 0,this.icon=void 0,this.maxWithQuery=3,this.maxWithoutQuery=void 0}componentWillLoad(){try{c((e=>(this.bindings=e,this.initialize())),this.host)}catch(e){this.error=e}}renderIcon(){return this.icon||h}initialize(){return this.storage=new l,this.recentQueriesList=i(this.bindings.engine,{initialState:{queries:this.retrieveLocalStorage()},options:{maxLength:1e3,clearFilters:this.bindings.clearFilters}}),this.recentQueriesList.subscribe((()=>this.updateLocalStorage())),{position:Array.from(this.host.parentNode.children).indexOf(this.host),renderItems:()=>this.renderItems()}}retrieveLocalStorage(){return this.storage.getParsedJSON(u.RECENT_QUERIES,[])}updateLocalStorage(){return this.recentQueriesList.state.analyticsEnabled?this.storage.setJSON(u.RECENT_QUERIES,this.recentQueriesList.state.queries):this.disableFeature()}disableFeature(){this.warnUser(),this.storage.removeItem(u.RECENT_QUERIES)}renderItems(){if(!this.recentQueriesList.state.analyticsEnabled)return[];const e=this.bindings.searchBoxController.state.value,t=""!==e?this.maxWithQuery:this.maxWithoutQuery,i=this.recentQueriesList.state.queries.filter((t=>t!==e&&t.toLowerCase().startsWith(e.toLowerCase()))).slice(0,t),r=i.map((e=>this.renderItem(e)));return r.length&&r.unshift(this.renderClear()),r}renderClear(){return{key:"recent-query-clear",content:e("div",{part:"recent-query-title-content",class:"flex justify-between w-full"},e("span",{class:"font-bold",part:"recent-query-title"},this.bindings.i18n.t("recent-searches")),e("span",{part:"recent-query-clear"},this.bindings.i18n.t("clear"))),ariaLabel:this.bindings.i18n.t("clear-recent-searches",{interpolation:{escapeValue:!1}}),onSelect:()=>{this.recentQueriesList.clear(),this.bindings.triggerSuggestions()},part:"recent-query-title-item suggestion-divider",hideIfLast:!0}}renderItem(t){const i=this.bindings.searchBoxController.state.value;return{key:`recent-${o(t)}`,query:t,part:"recent-query-item",content:e("div",{part:"recent-query-content",class:"flex items-center break-all text-left"},e("atomic-icon",{part:"recent-query-icon",icon:this.renderIcon(),class:"w-4 h-4 mr-2 shrink-0"}),""===i?e("span",{part:"recent-query-text",class:"break-all line-clamp-2"},t):e("span",{part:"recent-query-text",class:"break-all line-clamp-2",innerHTML:n.highlightString({content:t,openingDelimiter:'<span part="recent-query-text-highlight" class="font-bold">',closingDelimiter:"</span>",highlights:[{offset:i.length,length:t.length-i.length}]})})),ariaLabel:this.bindings.i18n.t("recent-query-suggestion-label",{query:t,interpolation:{escapeValue:!1}}),onSelect:()=>{if(this.bindings.isStandalone)return this.bindings.searchBoxController.updateText(t),void this.bindings.searchBoxController.submit();this.recentQueriesList.executeRecentQuery(this.recentQueriesList.state.queries.indexOf(t))}}}render(){if(this.error)return e("atomic-component-error",{element:this.host,error:this.error})}get host(){return s(this)}};export{d as atomic_search_box_query_suggestions,m as atomic_search_box_recent_queries};