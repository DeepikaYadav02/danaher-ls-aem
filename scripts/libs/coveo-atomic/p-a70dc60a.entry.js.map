{"version":3,"names":["atomicRefineModalCss","AtomicRefineModal","this","isOpen","collapseFacetsAfter","watchEnabled","host","querySelector","append","createFacetSlot","initialize","breadcrumbManager","buildBreadcrumbManager","bindings","engine","sort","buildSort","querySummary","buildQuerySummary","searchStatus","buildSearchStatus","facetManager","buildFacetManager","divSlot","document","createElement","setAttribute","addFacetColumnStyling","facets","store","getFacetElements","sortedFacets","sortFacetsUsingManager","visibleFacets","invisibleFacets","sortFacetVisibility","getAllFacets","visibleFacetsClone","cloneFacets","invisibleFacetsClone","generator","makeAutomaticFacetGenerator","updateCollapseFacetsDependingOnFacetsVisibility","length","map","facet","i","classList","remove","popoverClass","isRefineModalFacet","clone","cloneNode","isCollapsed","_a","state","automaticFacetSet","desiredCount","_b","el","style","display","flexDirection","gap","options","sortOptions","select","e","composedPath","option","find","expression","value","sortBy","criteria","buildOption","label","h","selected","isSortedBy","i18n","t","renderSort","Fragment","part","class","onChange","icon","SortIcon","renderFilters","hasFacetElements","hasAutomaticFacets","set","undefined","breadcrumbManagerState","hasBreadcrumbs","Button","onClick","deselectAll","text","name","renderBody","slot","render","RefineModalCommon","onClose","title","querySummaryState","openButton","componentDidLoad","__decorate","InitializeBindings","BindStateToController"],"sources":["src/components/search/atomic-refine-modal/atomic-refine-modal.pcss?tag=atomic-refine-modal&encapsulation=shadow","src/components/search/atomic-refine-modal/atomic-refine-modal.tsx"],"sourcesContent":["@import '../../common/refine-modal/refine-modal-common.pcss';\n\n:host {\n  position: absolute;\n}\n\n/**\n * @prop --atomic-refine-modal-facet-margin: The spacing between the modal's facets.\n */\nselect:hover + div,\nselect:focus-visible + div {\n  @apply text-primary-light;\n}\n","import {\n  BreadcrumbManager,\n  buildBreadcrumbManager,\n  BreadcrumbManagerState,\n  QuerySummary,\n  QuerySummaryState,\n  FacetManagerState,\n  Sort,\n  buildSort,\n  SortState,\n  buildQuerySummary,\n  buildSearchStatus,\n  SearchStatus,\n  FacetManager,\n  buildFacetManager,\n} from '@coveo/headless';\nimport {\n  Component,\n  h,\n  State,\n  Prop,\n  Element,\n  Watch,\n  Fragment,\n} from '@stencil/core';\nimport SortIcon from '../../../images/sort.svg';\nimport {\n  BindStateToController,\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../utils/initialization-utils';\nimport {Button} from '../../common/button';\nimport {\n  BaseFacetElement,\n  sortFacetVisibility,\n  sortFacetsUsingManager,\n  collapseFacetsAfter,\n} from '../../common/facets/facet-common';\nimport {isRefineModalFacet} from '../../common/interface/store';\nimport {RefineModalCommon} from '../../common/refine-modal/refine-modal-common';\nimport {Bindings} from '../atomic-search-interface/atomic-search-interface';\nimport {SortDropdownOption} from '../atomic-search-interface/store';\nimport {popoverClass} from '../facets/atomic-popover/popover-type';\n\n/**\n * The `atomic-refine-modal` is automatically created as a child of the `atomic-search-interface` when the `atomic-refine-toggle` is initialized.\n *\n * When the modal is opened, the class `atomic-modal-opened` is added to the interface element and the body, allowing further customization.\n *\n * @part container - The modal's outermost container.\n * @part header-wrapper - The wrapper around the header.\n * @part header - The header of the modal, containing the title.\n * @part title - The title of the modal.\n * @part close-button - The button in the header that closes the modal.\n * @part close-icon - The icon of the close button.\n * @part header-ruler - The horizontal ruler underneath the header.\n * @part body-wrapper - The wrapper around the body.\n * @part body - The body of the modal, between the header and the footer.\n * @part content - The wrapper around the content inside the body of the modal.\n * @part section-title - The title for each section.\n * @part section-sort-title - The title for the sort section.\n * @part section-filters-title - The title for the filters section.\n * @part select-wrapper - The wrapper around the select element, used to position the icon.\n * @part select - The `<select>` element of the dropdown list.\n * @part select-icon-wrapper - The wrapper around the sort icon that's used to align it.\n * @part select-icon - The select dropdown's sort icon.\n * @part filter-section - The section containing facets and the \"filters\" title.\n * @part filter-clear-all - The button that resets all actively selected facet values.\n * @part footer-wrapper - The wrapper with a shadow or background color around the footer.\n * @part footer - The footer of the modal.\n * @part footer-content - The wrapper around the content inside the footer of the modal, containing the button to view results.\n * @part footer-button - The button in the footer that closes the modal.\n * @part footer-button-text - The text inside the button in the footer that closes the modal.\n * @part footer-button-count - The count inside the button in the footer that closes the modal.\n */\n@Component({\n  tag: 'atomic-refine-modal',\n  styleUrl: 'atomic-refine-modal.pcss',\n  shadow: true,\n})\nexport class AtomicRefineModal implements InitializableComponent {\n  private sort!: Sort;\n  private breadcrumbManager!: BreadcrumbManager;\n  public querySummary!: QuerySummary;\n  public searchStatus!: SearchStatus;\n  public facetManager!: FacetManager;\n  @InitializeBindings() public bindings!: Bindings;\n  @Element() public host!: HTMLElement;\n\n  @BindStateToController('querySummary')\n  @State()\n  public querySummaryState!: QuerySummaryState;\n  @BindStateToController('breadcrumbManager')\n  @State()\n  private breadcrumbManagerState!: BreadcrumbManagerState;\n  @BindStateToController('facetManager')\n  @State()\n  public facetManagerState!: FacetManagerState;\n  @State() @BindStateToController('sort') public sortState!: SortState;\n  @State() public error!: Error;\n\n  @Prop({mutable: true}) openButton?: HTMLElement;\n\n  @Prop({reflect: true, mutable: true}) isOpen = false;\n\n  /**\n   * The number of expanded facets inside the refine modal.\n   * Remaining facets are automatically collapsed.\n   *\n   * Using the value `0` collapses all facets.\n   */\n  @Prop({reflect: true}) public collapseFacetsAfter = 0;\n\n  @Watch('isOpen')\n  watchEnabled(isOpen: boolean) {\n    if (isOpen) {\n      if (this.host.querySelector('div[slot=\"facets\"]')) {\n        return;\n      }\n\n      this.host.append(this.createFacetSlot());\n    }\n  }\n\n  public initialize() {\n    this.breadcrumbManager = buildBreadcrumbManager(this.bindings.engine);\n    this.sort = buildSort(this.bindings.engine);\n    this.querySummary = buildQuerySummary(this.bindings.engine);\n    this.searchStatus = buildSearchStatus(this.bindings.engine);\n    this.facetManager = buildFacetManager(this.bindings.engine);\n    this.watchEnabled(this.isOpen);\n  }\n\n  private createFacetSlot(): HTMLDivElement {\n    const divSlot = document.createElement('div');\n    divSlot.setAttribute('slot', 'facets');\n    this.addFacetColumnStyling(divSlot);\n\n    const facets = this.bindings.store.getFacetElements() as BaseFacetElement[];\n\n    const sortedFacets = sortFacetsUsingManager(facets, this.facetManager);\n\n    const {visibleFacets, invisibleFacets} = sortFacetVisibility(\n      sortedFacets,\n      this.bindings.store.getAllFacets()\n    );\n\n    const visibleFacetsClone = this.cloneFacets(visibleFacets);\n    const invisibleFacetsClone = this.cloneFacets(invisibleFacets);\n\n    collapseFacetsAfter(visibleFacetsClone, this.collapseFacetsAfter);\n\n    divSlot.append(...visibleFacetsClone);\n    divSlot.append(...invisibleFacetsClone);\n\n    const generator = this.makeAutomaticFacetGenerator();\n    if (generator) {\n      generator.updateCollapseFacetsDependingOnFacetsVisibility(\n        this.collapseFacetsAfter,\n        visibleFacets.length\n      );\n      divSlot.append(generator);\n    }\n\n    return divSlot;\n  }\n\n  private cloneFacets(facets: BaseFacetElement[]): BaseFacetElement[] {\n    return facets.map((facet, i) => {\n      facet.classList.remove(popoverClass);\n      facet.setAttribute(isRefineModalFacet, '');\n      const clone = facet.cloneNode(true) as BaseFacetElement;\n      clone.isCollapsed =\n        this.collapseFacetsAfter === -1\n          ? false\n          : i + 1 > this.collapseFacetsAfter;\n      return clone;\n    });\n  }\n\n  private makeAutomaticFacetGenerator() {\n    if (!this.bindings.engine.state.automaticFacetSet?.desiredCount) {\n      return;\n    }\n    const generator = document.createElement(\n      'atomic-automatic-facet-generator'\n    );\n\n    generator.setAttribute(\n      'desired-count',\n      `${this.bindings.engine.state.automaticFacetSet?.desiredCount}`\n    );\n    this.addFacetColumnStyling(generator);\n\n    return generator;\n  }\n\n  private addFacetColumnStyling(el: HTMLElement) {\n    el.style.display = 'flex';\n    el.style.flexDirection = 'column';\n    el.style.gap = 'var(--atomic-refine-modal-facet-margin, 20px)';\n  }\n\n  private get options() {\n    return this.bindings.store.state.sortOptions;\n  }\n\n  private select(e: Event) {\n    const select = e.composedPath()[0] as HTMLSelectElement;\n    const option = this.options.find(\n      (option) => option.expression === select.value\n    );\n    option && this.sort.sortBy(option.criteria);\n  }\n\n  private buildOption({expression, criteria, label}: SortDropdownOption) {\n    return (\n      <option value={expression} selected={this.sort.isSortedBy(criteria)}>\n        {this.bindings.i18n.t(label)}\n      </option>\n    );\n  }\n\n  private renderSort() {\n    if (!this.options.length) {\n      return;\n    }\n\n    return (\n      <Fragment>\n        <h1\n          part=\"section-title section-sort-title\"\n          class=\"text-2xl font-bold truncate mb-3\"\n        >\n          {this.bindings.i18n.t('sort')}\n        </h1>\n        <div part=\"select-wrapper\" class=\"relative\">\n          <select\n            class=\"btn-outline-neutral w-full cursor-pointer text-lg font-bold grow appearance-none rounded-lg px-6 py-5\"\n            part=\"select\"\n            aria-label={this.bindings.i18n.t('sort-by')}\n            onChange={(option) => this.select(option)}\n          >\n            {this.options.map((option) => this.buildOption(option))}\n          </select>\n          <div\n            part=\"select-icon-wrapper\"\n            class=\"absolute pointer-events-none top-0 bottom-0 right-0 flex justify-center items-center pr-6\"\n          >\n            <atomic-icon\n              part=\"select-icon\"\n              icon={SortIcon}\n              class=\"w-6 h-6\"\n            ></atomic-icon>\n          </div>\n        </div>\n      </Fragment>\n    );\n  }\n\n  private renderFilters() {\n    const hasFacetElements = this.bindings.store.getFacetElements().length > 0;\n    const hasAutomaticFacets =\n      this.bindings.engine.state.automaticFacetSet?.set !== undefined;\n\n    if (!hasFacetElements && !hasAutomaticFacets) {\n      return;\n    }\n\n    return (\n      <Fragment>\n        <div\n          part=\"filter-section\"\n          class=\"w-full flex justify-between mt-8 mb-3\"\n        >\n          <h1\n            part=\"section-title section-filters-title\"\n            class=\"text-2xl font-bold truncate\"\n          >\n            {this.bindings.i18n.t('filters')}\n          </h1>\n          {this.breadcrumbManagerState.hasBreadcrumbs && (\n            <Button\n              onClick={() => this.breadcrumbManager.deselectAll()}\n              style=\"text-primary\"\n              text={this.bindings.i18n.t('clear')}\n              class=\"px-2 py-1\"\n              part=\"filter-clear-all\"\n            ></Button>\n          )}\n        </div>\n        <slot name=\"facets\"></slot>\n        <slot name=\"automatic-facets\"></slot>\n      </Fragment>\n    );\n  }\n\n  private renderBody() {\n    return (\n      <aside\n        part=\"content\"\n        slot=\"body\"\n        class=\"flex flex-col w-full adjust-for-scroll-bar\"\n      >\n        {this.renderSort()}\n        {this.renderFilters()}\n      </aside>\n    );\n  }\n\n  public render() {\n    return (\n      <RefineModalCommon\n        bindings={this.bindings}\n        host={this.host}\n        isOpen={this.isOpen}\n        onClose={() => (this.isOpen = false)}\n        title={this.bindings.i18n.t('sort-and-filter')}\n        querySummaryState={this.querySummaryState}\n        openButton={this.openButton}\n      >\n        {this.renderBody()}\n      </RefineModalCommon>\n    );\n  }\n\n  public componentDidLoad() {\n    this.host.style.display = '';\n  }\n}\n"],"mappings":"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"}