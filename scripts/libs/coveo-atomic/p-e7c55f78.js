import{S as t,a as e}from"./p-3eb3e1ff.js";import{h as s}from"./p-591772f1.js";import{g as i}from"./p-85aa182a.js";import{r}from"./p-a5540571.js";import{i as a}from"./p-fa940542.js";import{H as h}from"./p-a096f4ab.js";import{j as n,v as l,F as u}from"./p-e9fa8599.js";import{F as o,g as d,b as c,d as f,e as v,c as m}from"./p-044ef394.js";class p{constructor(e){this.props=e,this.manualRanges=[],this.validateProps(),this.facetId=this.determineFacetId,this.props.setFacetId(this.facetId),this.props.numberOfValues>0&&(this.manualRanges=this.props.setManualRanges(Array.from(this.props.host.querySelectorAll("atomic-numeric-range")).map((({start:e,end:t,endInclusive:s,label:i})=>({...this.props.buildNumericRange({start:e,end:t,endInclusive:s}),label:i})))),this.facetForRange=this.props.initializeFacetForRange()),this.props.withInput&&(this.facetForInput=this.props.initializeFacetForInput(),this.filter=this.props.initializeFilter()),this.dependenciesManager=this.props.buildDependenciesManager(),this.registerFacetToStore()}get determineFacetId(){return this.props.facetId?this.props.facetId:this.props.bindings.store.get("numericFacets")[this.props.field]?r(`${this.props.field}_`):this.props.field}get formatter(){return this.props.getFormatter()}get enabled(){var e,t,s,i;return null===(i=null!==(t=null===(e=this.facetForRange)||void 0===e?void 0:e.state.enabled)&&void 0!==t?t:null===(s=this.filter)||void 0===s?void 0:s.state.enabled)||void 0===i||i}get hasValues(){var e;return!!(null===(e=this.facetForInput)||void 0===e?void 0:e.state.values.length)||!!this.valuesToRender.length}get numberOfSelectedValues(){var e,t;return(null===(e=this.filter)||void 0===e?void 0:e.state.range)?1:(null===(t=this.facetForRange)||void 0===t?void 0:t.state.values.filter((({state:e})=>"selected"===e)).length)||0}get hasInputRange(){var e;return!!(null===(e=this.filter)||void 0===e?void 0:e.state.range)}get shouldRenderFacet(){return this.shouldRenderInput||this.shouldRenderValues}get searchStatusState(){return this.props.getSearchStatusState()}get shouldRenderInput(){var e;return n({hasInputRange:this.hasInputRange,searchStatusState:this.searchStatusState,facetValues:(null===(e=this.facetForInput)||void 0===e?void 0:e.state.values)||[],hasInput:!!this.props.withInput})}get shouldRenderValues(){return!this.hasInputRange&&this.props.numberOfValues>0&&!!this.valuesToRender.length}validateProps(){new t({displayValuesAs:new e({constrainTo:["checkbox","link"]}),withInput:new e({constrainTo:["integer","decimal"]})}).validate({displayValuesAs:this.props.displayValuesAs,withInput:this.props.withInput}),l(this.props.dependsOn)}disconnectedCallback(){var e;this.props.host.isConnected||null===(e=this.dependenciesManager)||void 0===e||e.stopWatching()}get isHidden(){return!this.shouldRenderFacet||!this.enabled}registerFacetToStore(){const e={label:()=>this.props.bindings.i18n.t(this.props.label),facetId:this.facetId,element:this.props.host,isHidden:()=>this.isHidden};this.props.bindings.store.registerFacet("numericFacets",{...e,format:e=>this.formatFacetValue(e)}),a(this.props.host,{...e,hasValues:()=>this.hasValues,numberOfSelectedValues:()=>this.numberOfSelectedValues}),this.filter&&(this.props.bindings.store.state.numericFacets[this.filter.state.facetId]=this.props.bindings.store.state.numericFacets[this.facetId])}formatFacetValue(e){var t;const s=null===(t=this.manualRanges.find((t=>this.areRangesEqual(t,e))))||void 0===t?void 0:t.label;return s?i(this.props.field,s,this.props.bindings.i18n):this.props.bindings.i18n.t("to",{start:this.formatValue(e.start),end:this.formatValue(e.end)})}formatValue(e){try{return this.formatter(e,this.props.bindings.i18n.languages)}catch(t){return this.props.bindings.engine.logger.error(`atomic-numeric-facet facet value "${e}" could not be formatted correctly.`,t),e}}areRangesEqual(e,t){return e.start===t.start&&e.end===t.end&&e.endInclusive===t.endInclusive}renderValue(e,t){const i=this.formatFacetValue(e),r="selected"===e.state;switch(this.props.displayValuesAs){case"checkbox":return s(d,{displayValue:i,numberOfResults:e.numberOfResults,isSelected:r,i18n:this.props.bindings.i18n,onClick:t},s(o,{displayValue:i,isSelected:r}));case"link":return s(u,{displayValue:i,numberOfResults:e.numberOfResults,isSelected:r,i18n:this.props.bindings.i18n,onClick:t},s(o,{displayValue:i,isSelected:r}))}}renderValuesContainer(e){return s(c,{i18n:this.props.bindings.i18n,label:this.props.label},s("ul",{class:"mt-3",part:"values"},e))}get valuesToRender(){var e;return(null===(e=this.facetForRange)||void 0===e?void 0:e.state.values.filter((e=>e.numberOfResults||"idle"!==e.state)))||[]}renderValues(){return this.renderValuesContainer(this.valuesToRender.map((e=>this.renderValue(e,(()=>"link"===this.props.displayValuesAs?this.facetForRange.toggleSingleSelect(e):this.facetForRange.toggleSelect(e))))))}renderNumberInput(){return s("atomic-facet-number-input",{type:this.props.withInput,bindings:this.props.bindings,label:this.props.label,filter:this.filter,filterState:this.filter.state})}renderHeader(e,t,i){return s(f,{i18n:this.props.bindings.i18n,label:this.props.label,onClearFilters:()=>{var t,s,i;e.focusAfterSearch(),(null===(t=this.filter)||void 0===t?void 0:t.state.range)?null===(s=this.filter)||void 0===s||s.clear():null===(i=this.facetForRange)||void 0===i||i.deselectAll()},numberOfSelectedValues:this.numberOfSelectedValues,isCollapsed:t,headingLevel:this.props.headingLevel,onToggleCollapse:i,headerRef:t=>e.setTarget(t)})}render({hasError:e,firstSearchExecuted:t,isCollapsed:i,headerFocus:r,onToggleCollapse:a}){return e||!this.enabled?s(h,null):t?this.shouldRenderFacet?s(m,null,this.renderHeader(r,i,a),!i&&[this.shouldRenderValues&&this.renderValues(),this.shouldRenderInput&&this.renderNumberInput()]):s(h,null):s(v,{numberOfValues:this.props.numberOfValues,isCollapsed:i})}}export{p as N};