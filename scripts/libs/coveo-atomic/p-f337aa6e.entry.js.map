{"version":3,"names":["FacetDateInput","connectedCallback","this","start","filterState","range","parseDate","toDate","undefined","end","apply","startRef","validity","valid","endRef","applyInput","emit","filter","setRange","buildDateRange","formattedDateValue","date","format","render","label","bindings","i18n","t","startLabel","endLabel","startAria","endAria","applyAria","inputClasses","labelClasses","placeholder","pattern","h","class","onSubmit","e","preventDefault","part","htmlFor","facetId","id","type","ref","required","min","max","value","_a","onInput","target","_b","Button","style","ariaLabel","text"],"sources":["src/components/common/facets/facet-date-input/facet-date-input.tsx"],"sourcesContent":["import {buildDateRange} from '@coveo/headless';\nimport {Component, h, State, Prop, Event, EventEmitter} from '@stencil/core';\nimport {parseDate} from '../../../../utils/date-utils';\nimport {Button} from '../../button';\nimport {AnyBindings} from '../../interface/bindings';\nimport {DateFilter, DateFilterState} from '../../types';\n\n/**\n * Internal component made to be integrated in a TimeframeFacet.\n * @internal\n */\n@Component({\n  tag: 'atomic-facet-date-input',\n  shadow: false,\n})\nexport class FacetDateInput {\n  @State() private start?: Date;\n  @State() private end?: Date;\n  private startRef!: HTMLInputElement;\n  private endRef!: HTMLInputElement;\n\n  @Prop() public bindings!: AnyBindings;\n  @Prop() public filter!: DateFilter;\n  @Prop() public filterState!: DateFilterState;\n  @Prop() public label!: string;\n  @Prop() public min?: string;\n  @Prop() public max?: string;\n\n  @Event({\n    eventName: 'atomic/dateInputApply',\n  })\n  private applyInput!: EventEmitter;\n\n  public connectedCallback() {\n    this.start = this.filterState.range\n      ? parseDate(this.filterState.range.start).toDate()\n      : undefined;\n    this.end = this.filterState.range\n      ? parseDate(this.filterState.range.end).toDate()\n      : undefined;\n  }\n\n  private apply() {\n    if (!this.startRef.validity.valid || !this.endRef.validity.valid) {\n      return;\n    }\n\n    this.applyInput.emit();\n    this.filter.setRange(\n      buildDateRange({\n        start: this.start!,\n        end: this.end!,\n      })\n    );\n  }\n\n  private formattedDateValue(date?: string | Date) {\n    if (!date) {\n      return '';\n    }\n    return parseDate(date).format('YYYY-MM-DD');\n  }\n\n  render() {\n    const label = this.bindings.i18n.t(this.label);\n    const startLabel = this.bindings.i18n.t('start');\n    const endLabel = this.bindings.i18n.t('end');\n    const startAria = this.bindings.i18n.t('date-input-start', {label});\n    const endAria = this.bindings.i18n.t('date-input-end', {label});\n    const apply = this.bindings.i18n.t('apply');\n    const applyAria = this.bindings.i18n.t('date-input-apply', {label});\n\n    const inputClasses = 'input-primary p-2.5';\n    const labelClasses = 'text-neutral-dark self-center';\n\n    const placeholder = 'yyyy-mm-dd';\n    // Fallback for Safari < 14.1, date with format yyyy-mm-dd over 1400 (API limit)\n    const pattern =\n      '^(1[4-9]\\\\d{2}|2\\\\d{3})-(0[1-9]|1[0-2])-(0[1-9]|[12]\\\\d|3[01])$';\n\n    return (\n      <form\n        class=\"grid gap-2 grid-cols-min-1fr mt-4 px-2\"\n        onSubmit={(e) => {\n          e.preventDefault();\n          this.apply();\n          return false;\n        }}\n      >\n        <label\n          part=\"input-label\"\n          class={labelClasses}\n          htmlFor={`${this.filterState.facetId}_start`}\n        >\n          {startLabel}:\n        </label>\n        <input\n          id={`${this.filterState.facetId}_start`}\n          part=\"input-start\"\n          type=\"date\"\n          ref={(ref) => (this.startRef = ref!)}\n          class={inputClasses}\n          aria-label={startAria}\n          placeholder={placeholder}\n          pattern={pattern}\n          required\n          // API/Index minimum supported date\n          min={this.min || this.formattedDateValue('1401-01-01')}\n          max={this.end ? this.formattedDateValue(this.end) : this.max}\n          value={this.formattedDateValue(this.filterState.range?.start)}\n          onInput={(e) =>\n            (this.start = parseDate(\n              (e.target as HTMLInputElement).value\n            ).toDate())\n          }\n        />\n        <label\n          part=\"input-label\"\n          class={labelClasses}\n          htmlFor={`${this.filterState.facetId}_end`}\n        >\n          {endLabel}:\n        </label>\n        <input\n          id={`${this.filterState.facetId}_end`}\n          part=\"input-end\"\n          type=\"date\"\n          ref={(ref) => (this.endRef = ref!)}\n          class={inputClasses}\n          aria-label={endAria}\n          placeholder={placeholder}\n          pattern={pattern}\n          required\n          min={this.min || this.formattedDateValue(this.start)}\n          max={this.max}\n          value={this.formattedDateValue(this.filterState.range?.end)}\n          onInput={(e) =>\n            (this.end = parseDate(\n              (e.target as HTMLInputElement).value\n            ).toDate())\n          }\n        />\n        <Button\n          style=\"outline-primary\"\n          type=\"submit\"\n          part=\"input-apply-button\"\n          class=\"p-2.5 col-span-2 truncate\"\n          ariaLabel={applyAria}\n          text={apply}\n        ></Button>\n      </form>\n    );\n  }\n}\n"],"mappings":"4RAeaA,EAAc,M,uPAkBlB,iBAAAC,GACLC,KAAKC,MAAQD,KAAKE,YAAYC,MAC1BC,EAAUJ,KAAKE,YAAYC,MAAMF,OAAOI,SACxCC,UACJN,KAAKO,IAAMP,KAAKE,YAAYC,MACxBC,EAAUJ,KAAKE,YAAYC,MAAMI,KAAKF,SACtCC,S,CAGE,KAAAE,GACN,IAAKR,KAAKS,SAASC,SAASC,QAAUX,KAAKY,OAAOF,SAASC,MAAO,CAChE,M,CAGFX,KAAKa,WAAWC,OAChBd,KAAKe,OAAOC,SACVC,EAAe,CACbhB,MAAOD,KAAKC,MACZM,IAAKP,KAAKO,M,CAKR,kBAAAW,CAAmBC,GACzB,IAAKA,EAAM,CACT,MAAO,E,CAET,OAAOf,EAAUe,GAAMC,OAAO,a,CAGhC,MAAAC,G,QACE,MAAMC,EAAQtB,KAAKuB,SAASC,KAAKC,EAAEzB,KAAKsB,OACxC,MAAMI,EAAa1B,KAAKuB,SAASC,KAAKC,EAAE,SACxC,MAAME,EAAW3B,KAAKuB,SAASC,KAAKC,EAAE,OACtC,MAAMG,EAAY5B,KAAKuB,SAASC,KAAKC,EAAE,mBAAoB,CAACH,UAC5D,MAAMO,EAAU7B,KAAKuB,SAASC,KAAKC,EAAE,iBAAkB,CAACH,UACxD,MAAMd,EAAQR,KAAKuB,SAASC,KAAKC,EAAE,SACnC,MAAMK,EAAY9B,KAAKuB,SAASC,KAAKC,EAAE,mBAAoB,CAACH,UAE5D,MAAMS,EAAe,sBACrB,MAAMC,EAAe,gCAErB,MAAMC,EAAc,aAEpB,MAAMC,EACJ,kEAEF,OACEC,EAAA,QACEC,MAAM,yCACNC,SAAWC,IACTA,EAAEC,iBACFvC,KAAKQ,QACL,OAAO,KAAK,GAGd2B,EAAA,SACEK,KAAK,cACLJ,MAAOJ,EACPS,QAAS,GAAGzC,KAAKE,YAAYwC,iBAE5BhB,EAAU,KAEbS,EAAA,SACEQ,GAAI,GAAG3C,KAAKE,YAAYwC,gBACxBF,KAAK,cACLI,KAAK,OACLC,IAAMA,GAAS7C,KAAKS,SAAWoC,EAC/BT,MAAOL,EAAY,aACPH,EACZK,YAAaA,EACbC,QAASA,EACTY,SAAQ,KAERC,IAAK/C,KAAK+C,KAAO/C,KAAKkB,mBAAmB,cACzC8B,IAAKhD,KAAKO,IAAMP,KAAKkB,mBAAmBlB,KAAKO,KAAOP,KAAKgD,IACzDC,MAAOjD,KAAKkB,oBAAmBgC,EAAAlD,KAAKE,YAAYC,SAAK,MAAA+C,SAAA,SAAAA,EAAEjD,OACvDkD,QAAUb,GACPtC,KAAKC,MAAQG,EACXkC,EAAEc,OAA4BH,OAC/B5C,WAGN8B,EAAA,SACEK,KAAK,cACLJ,MAAOJ,EACPS,QAAS,GAAGzC,KAAKE,YAAYwC,eAE5Bf,EAAQ,KAEXQ,EAAA,SACEQ,GAAI,GAAG3C,KAAKE,YAAYwC,cACxBF,KAAK,YACLI,KAAK,OACLC,IAAMA,GAAS7C,KAAKY,OAASiC,EAC7BT,MAAOL,EAAY,aACPF,EACZI,YAAaA,EACbC,QAASA,EACTY,SAAQ,KACRC,IAAK/C,KAAK+C,KAAO/C,KAAKkB,mBAAmBlB,KAAKC,OAC9C+C,IAAKhD,KAAKgD,IACVC,MAAOjD,KAAKkB,oBAAmBmC,EAAArD,KAAKE,YAAYC,SAAK,MAAAkD,SAAA,SAAAA,EAAE9C,KACvD4C,QAAUb,GACPtC,KAAKO,IAAMH,EACTkC,EAAEc,OAA4BH,OAC/B5C,WAGN8B,EAACmB,EAAM,CACLC,MAAM,kBACNX,KAAK,SACLJ,KAAK,qBACLJ,MAAM,4BACNoB,UAAW1B,EACX2B,KAAMjD,I"}