import{h as t}from"./p-591772f1.js";import{p as i}from"./p-f2ab2fa8.js";import{g as s}from"./p-85aa182a.js";import{r as e}from"./p-a5540571.js";import{i as r}from"./p-fa940542.js";import{H as a}from"./p-a096f4ab.js";import{j as h,v as n,F as l}from"./p-e9fa8599.js";import{F as u,b as o,d,e as f,c as v}from"./p-044ef394.js";class p{constructor(e){this.props=e,this.manualTimeframes=[],this.validateProps(),this.facetId=this.determineFacetId,this.props.setFacetId(this.facetId),this.manualTimeframes=this.getManualTimeframes(),this.manualTimeframes.length>0&&(this.facetForDateRange=this.props.initializeFacetForDateRange(this.currentValues)),this.props.withDatePicker&&(this.facetForDatePicker=this.props.initializeFacetForDatePicker(),this.filter=this.props.initializeFilter()),(this.facetForDateRange||this.filter)&&(this.dependenciesManager=this.props.buildDependenciesManager()),this.registerFacetToStore()}get determineFacetId(){return this.props.facetId?this.props.facetId:this.props.bindings.store.get("dateFacets")[this.props.field]?e(`${this.props.field}_`):this.props.field}get enabled(){var e,t,s,i;return null===(i=null!==(t=null===(e=this.facetForDateRange)||void 0===e?void 0:e.state.enabled)&&void 0!==t?t:null===(s=this.filter)||void 0===s?void 0:s.state.enabled)||void 0===i||i}get valuesToRender(){var e;return(null===(e=this.facetForDateRange)||void 0===e?void 0:e.state.values.filter((e=>e.numberOfResults||"idle"!==e.state)))||[]}get shouldRenderValues(){return!this.hasInputRange&&!!this.valuesToRender.length}get shouldRenderFacet(){return this.shouldRenderInput||this.shouldRenderValues}get shouldRenderInput(){var e,t;return h({hasInput:this.props.withDatePicker,hasInputRange:this.hasInputRange,searchStatusState:this.props.getSearchStatusState(),facetValues:(null===(t=null===(e=this.facetForDatePicker)||void 0===e?void 0:e.state)||void 0===t?void 0:t.values)||[]})}get hasValues(){var e;return!!(null===(e=this.facetForDatePicker)||void 0===e?void 0:e.state.values.length)||!!this.valuesToRender.length}get numberOfSelectedValues(){var e,t,s;return(null===(t=null===(e=this.filter)||void 0===e?void 0:e.state)||void 0===t?void 0:t.range)?1:(null===(s=this.facetForDateRange)||void 0===s?void 0:s.state.values.filter((({state:e})=>"selected"===e)).length)||0}get hasInputRange(){var e;return!!(null===(e=this.filter)||void 0===e?void 0:e.state.range)}get currentValues(){return this.manualTimeframes.map((({period:e,amount:t,unit:s})=>"past"===e?this.props.buildDateRange({start:{period:e,unit:s,amount:t},end:{period:"now"}}):this.props.buildDateRange({start:{period:"now"},end:{period:e,unit:s,amount:t}})))}disconnectedCallback(){var e;this.props.host.isConnected||null===(e=this.dependenciesManager)||void 0===e||e.stopWatching()}get isHidden(){return!this.shouldRenderFacet||!this.enabled}validateProps(){n(this.props.dependsOn)}registerFacetToStore(){const e={label:()=>this.props.bindings.i18n.t(this.props.label),facetId:this.facetId,element:this.props.host,isHidden:()=>this.isHidden};this.props.bindings.store.registerFacet("dateFacets",{...e,format:e=>this.formatFacetValue(e)}),r(this.props.host,{...e,hasValues:()=>this.hasValues,numberOfSelectedValues:()=>this.numberOfSelectedValues}),this.filter&&(this.props.bindings.store.state.dateFacets[this.filter.state.facetId]=this.props.bindings.store.state.dateFacets[this.facetId])}getManualTimeframes(){return Array.from(this.props.host.querySelectorAll("atomic-timeframe")).map((({label:e,amount:t,unit:s,period:i})=>({label:e,amount:t,unit:s,period:i})))}formatFacetValue(e){try{const t=this.props.deserializeRelativeDate(e.start),i="past"===t.period?t:this.props.deserializeRelativeDate(e.end),a=this.getManualTimeframes().find((e=>e.period===i.period&&e.unit===i.unit&&e.amount===i.amount));return(null==a?void 0:a.label)?s(this.props.field,a.label,this.props.bindings.i18n):this.props.bindings.i18n.t(`${i.period}-${i.unit}`,{count:i.amount})}catch(t){return this.props.bindings.i18n.t("to",{start:i(e.start).format("YYYY-MM-DD"),end:i(e.end).format("YYYY-MM-DD")})}}renderValues(){return this.renderValuesContainer(this.valuesToRender.map((e=>this.renderValue(e))))}renderValue(e){const s=this.formatFacetValue(e),i="selected"===e.state;return t(l,{displayValue:s,isSelected:i,numberOfResults:e.numberOfResults,i18n:this.props.bindings.i18n,onClick:()=>this.facetForDateRange.toggleSingleSelect(e)},t(u,{displayValue:s,isSelected:i}))}renderValuesContainer(e){return t(o,{i18n:this.props.bindings.i18n,label:this.props.label},t("ul",{class:"mt-3",part:"values"},e))}renderHeader(e,s,i){return t(d,{i18n:this.props.bindings.i18n,label:this.props.label,onClearFilters:()=>{var e,t,i;s.focusAfterSearch(),(null===(e=this.filter)||void 0===e?void 0:e.state.range)?null===(t=this.filter)||void 0===t||t.clear():null===(i=this.facetForDateRange)||void 0===i||i.deselectAll()},numberOfSelectedValues:this.numberOfSelectedValues,isCollapsed:e,headingLevel:this.props.headingLevel,onToggleCollapse:i,headerRef:e=>s.setTarget(e)})}renderDateInput(){return t("atomic-facet-date-input",{min:this.props.min,max:this.props.max,bindings:this.props.bindings,label:this.props.label,filter:this.filter,filterState:this.filter.state})}render({hasError:e,firstSearchExecuted:s,isCollapsed:i,headerFocus:r,onToggleCollapse:n}){return e||!this.enabled?t(a,null):s?this.shouldRenderFacet?t(v,null,this.renderHeader(i,r,n),!i&&[this.shouldRenderValues&&this.renderValues(),this.shouldRenderInput&&this.renderDateInput()]):t(a,null):t(f,{numberOfValues:this.currentValues.length,isCollapsed:i})}}export{p as T};