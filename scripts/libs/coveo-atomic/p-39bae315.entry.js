import{r as t,h as s,g as e}from"./p-591772f1.js";import{E as i,Q as r}from"./p-d2151deb.js";import{e as n}from"./p-9cfa1365.js";import{a as o}from"./p-18dbee89.js";import{R as a}from"./p-fcb55194.js";import{d as l}from"./p-ccd551fb.js";import"./p-1e65cba6.js";import"./p-92adf573.js";import"./p-a5540571.js";import"./p-eab67c09.js";const h=class{constructor(e){t(this,e),this.results=[],this.display="list",this.templateHasError=!1,this.maxResultsPerQuery=4,this.density="normal",this.imageSize="icon",this.error=void 0,this.templateHasError=!1,this.maxResultsPerQuery=4,this.density="normal",this.imageSize="icon",this.ariaLabelGenerator=void 0}async setRenderFunction(t){this.resultRenderingFunction=t}componentWillLoad(){try{l((t=>(this.bindings=t,this.initialize())),this.host)}catch(t){this.error=t}}getLink(t){var e,s;return(null===(s=null===(e=null==t?void 0:t.querySelector("atomic-result"))||void 0===e?void 0:e.shadowRoot)||void 0===s?void 0:s.querySelector("atomic-result-link a"))||null}handleLinkClick(t,e){const s=e=>t.setAttribute("target",e),i=t.getAttribute("target");return e&&s("_blank"),t.click(),e&&s(i||""),!0}renderItems(){if(!this.bindings.suggestedQuery()||this.bindings.store.isMobile())return[];const t=(this.instantResults.state.results.length?this.instantResults.state.results:this.results).map((t=>{var e;return{key:`instant-result-${n(t.uniqueId)}`,part:"instant-results-item",content:s("atomic-result",{key:`instant-result-${n(t.uniqueId)}`,part:"outline",result:t,interactiveResult:i(this.bindings.engine,{options:{result:t}}),display:this.display,density:this.density,imageSize:this.imageSize,content:this.resultTemplateProvider.getTemplateContent(t),stopPropagation:!1,renderingFunction:this.resultRenderingFunction}),ariaLabel:this.bindings.i18n.t("instant-results-suggestion-label",{title:(null===(e=this.ariaLabelGenerator)||void 0===e?void 0:e.call(this,this.bindings,t))||t.title,interpolation:{escapeValue:!1}}),onSelect:t=>{const e=this.getLink(t.target);e&&this.handleLinkClick(e,t.ctrlKey||t.metaKey)}}}));if(t.length){const e=this.bindings.i18n.t("show-all-results");t.push({key:"instant-results-show-all-button",content:s("div",{part:"instant-results-show-all-button",class:o("text-primary")},e),part:"instant-results-show-all",ariaLabel:e,onSelect:()=>{this.bindings.clearSuggestions(),this.bindings.searchBoxController.updateText(this.instantResults.state.q),this.bindings.searchBoxController.submit()}})}return t}initialize(){return this.instantResults=r(this.bindings.engine,{options:{maxResultsPerQuery:this.maxResultsPerQuery}}),this.resultTemplateProvider=new a({includeDefaultTemplate:!0,templateElements:Array.from(this.host.querySelectorAll("atomic-result-template")),getResultTemplateRegistered:()=>!0,setResultTemplateRegistered:()=>{},getTemplateHasError:()=>this.templateHasError,setTemplateHasError:t=>{this.templateHasError=t},bindings:this.bindings}),{position:Array.from(this.host.parentNode.children).indexOf(this.host),panel:"right",onSuggestedQueryChange:t=>(this.instantResults.updateQuery(t),this.onSuggestedQueryChange()),renderItems:()=>this.renderItems()}}onSuggestedQueryChange(){return this.bindings.getSuggestionElements().length||this.bindings.searchBoxController.state.value||console.warn("There doesn't seem to be any query suggestions configured. Make sure to include either an atomic-search-box-query-suggestions or atomic-search-box-recent-queries in your search box in order to see some instant results."),new Promise((t=>{const e=this.instantResults.subscribe((()=>{const s=this.instantResults.state;s.isLoading||(s.results.length&&(this.results=s.results),e(),t())}))}))}render(){if(this.error)return s("atomic-component-error",{element:this.host,error:this.error})}get host(){return e(this)}};export{h as atomic_search_box_instant_results};