import{S as e,a as t}from"./p-3eb3e1ff.js";import{h as s}from"./p-591772f1.js";import{a as r,g as a}from"./p-85aa182a.js";import{i as n}from"./p-fa940542.js";import{H as i}from"./p-a096f4ab.js";import{f as l,s as o,d as c,b as u,F as h,g as f,a as p,e as d,c as m}from"./p-044ef394.js";import{C as b}from"./p-fafae456.js";import{S as v}from"./p-cfb3c589.js";import{B as x}from"./p-59a8a3f5.js";const w=e=>{const t=e.i18n.t(e.label),a=e.i18n.t("facet-search-input"),r=e.i18n.t("facet-search",{label:t}),n=e.i18n.t("clear");let i;return s("div",{class:"px-2 mt-3",part:"search-wrapper"},s("div",{class:"relative h-10"},s("input",{part:"search-input",class:"input-primary w-full h-full px-9 placeholder-neutral-dark text-sm group",type:"text",placeholder:a,"aria-label":r,value:e.query,onInput:t=>e.onChange(t.target.value),ref:e=>i=e}),s("div",{class:"search-icon pointer-events-none absolute inline-flex justify-center items-center left-0 w-9 h-full text-on-background"},s("atomic-icon",{part:"search-icon",icon:v})),""!==e.query&&s(x,{style:"text-transparent",title:n,class:"search-clear-button absolute inline-flex justify-center items-center right-px w-9 top-px bottom-px",onClick:()=>{e.onClear(),i.focus()}},s("atomic-icon",{part:"search-clear-button",icon:b}))))};function y(e,t,s){return s.t(e,{query:`<span class="font-bold italic text-on-background" part="matches-query">${l(t)}</span>`,interpolation:{escapeValue:!1}})}const g=e=>e.numberOfMatches?e.hasMoreMatches?s("div",{class:"px-2"},s("div",{part:"more-matches",class:"truncate mt-3 text-neutral-dark text-sm",innerHTML:y("more-matches-for",e.query,e.i18n)})):void 0:s("div",{class:"px-2"},s("div",{part:"no-matches",class:"truncate p-3 bg-neutral-light text-neutral-dark text-sm rounded",innerHTML:y("no-matches-found-for",e.query,e.i18n)})),k='<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m64 208h384v96h-384z"/></svg>',V='<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">\n  <path d="M496 208H304V16h-96v192H16v96h192v192h96V304h192"/>\n</svg>\n',S=e=>{const t=e.i18n.t(e.label),a=e.i18n.t("show-more"),r=e.i18n.t("show-more-facet-values",{label:t}),n=e.i18n.t("show-less"),i=e.i18n.t("show-less-facet-values",{label:t}),l="flex items-baseline text-left p-2 text-sm max-w-full",c="w-2 h-2 mr-1";if(e.canShowLessValues||e.canShowMoreValues)return s("div",{class:"mt-2"},s(x,{style:"text-primary",part:"show-less",class:`${l} ${e.canShowLessValues?"":"hidden"}`,ariaLabel:i,onClick:()=>e.onShowLess(),ref:e.showLessRef},s("atomic-icon",{part:"show-more-less-icon",class:c,icon:k}),s("span",{class:"truncate"},n)),s(x,{style:"text-primary",part:"show-more",class:`${l} ${e.canShowMoreValues?"":"hidden"}`,ariaLabel:r,onClick:()=>e.onShowMore(),ref:e.showMoreRef},s("atomic-icon",{part:"show-more-less-icon",class:c,icon:V}),s("span",{class:"truncate"},a)))},C=(e,t)=>{const a=new Intl.NumberFormat(e.i18n.language,{notation:"compact"}).format(e.numberOfResults),r=e.numberOfResults.toLocaleString(e.i18n.language),n=e.i18n.t("facet-value",{value:e.displayValue,count:e.numberOfResults});return s("li",{key:e.displayValue},s(x,{style:"outline-bg-neutral",part:"value-box"+(e.isSelected?" value-box-selected":""),onClick:()=>e.onClick(),class:"value-box box-border w-full h-full items-center p-2 group "+(e.isSelected?"selected":""),ariaPressed:e.isSelected.toString(),ariaLabel:n,ref:e.buttonRef},t,s("span",{title:r,part:"value-count",class:"value-box-count text-neutral-dark truncate w-full text-sm mt-1"},e.i18n.t("between-parentheses",{text:a}))))},O=(e,t)=>{var a;const r=e.numberOfResults.toLocaleString(e.i18n.language),n=e.i18n.t("facet-value",{value:e.displayValue,count:e.numberOfResults,interpolation:{escapeValue:!1}});let i=null!==(a=e.part)&&void 0!==a?a:"value-link"+(e.isSelected?" value-link-selected":"");return e.additionalPart&&(i+=` ${e.additionalPart}`),s("li",{key:e.displayValue,class:e.class},s(x,{style:"text-neutral",part:i,onClick:()=>e.onClick(),class:"group w-full flex items-center px-2 py-2.5 text-left truncate no-outline",ariaPressed:e.isSelected.toString(),ariaLabel:n,ref:e.buttonRef},t,s("span",{part:"value-count",class:"value-count"},e.i18n.t("between-parentheses",{text:r}))),e.subList)};function j(e){return"children"in e&&Array.isArray(e.children)}function M(e){return"value"in e&&"string"==typeof e.value&&!("children"in e)}function R(e){if("selected"===e.state)return e;for(const t of e.children){const e=R(t);if(null!==e)return e}return null}function I(e){return Object.entries(e).map((([e,t])=>({parentFacetId:e,condition:e=>e.some((e=>{if(j(e)){const s=R(e);return!(!s||t&&s.value!==t)}return!(!M(e)||"selected"!==e.state||t&&e.value!==t)}))})))}function L(e){if(Object.keys(e).length>1)throw"Depending on multiple facets isn't supported"}function A(e){const{hasInput:t,hasInputRange:s,searchStatusState:a,facetValues:r}=e;if(!t)return!1;if(s)return!0;if(!a.hasResults)return!1;const n=r.filter((e=>e.numberOfResults||"idle"!==e.state))||[];return!!n.length}function F(e,t){const s=[],a=[];return e.forEach((e=>{t[e.facetId]&&t[e.facetId].isHidden()?a.push(e):s.push(e)})),{visibleFacets:s,invisibleFacets:a}}function T(e,t){-1!==t&&e.forEach(((e,s)=>{e.isCollapsed=s+1>t}))}function $(e){return"ATOMIC-AUTOMATIC-FACET-GENERATOR"===e.tagName}function H(e){return"facetId"in e}function Q(e){return Array.from(e.children).filter((e=>H(e)))}function q(e){return Array.from(e.children).find($)}function E(e,t){const s=e.map((e=>({facetId:e.facetId,payload:e})));return t.sort(s).map((e=>e.payload))}class B{constructor(e){this.resultIndexToFocusOnShowMore=0,this.host=e.host,this.bindings=e.bindings,this.label=e.label,this.field=e.field,this.headingLevel=e.headingLevel,this.displayValuesAs=e.displayValuesAs,this.dependsOn=e.dependsOn,this.dependenciesManager=e.dependenciesManager,this.facet=e.facet,this.facetId=e.facetId,this.sortCriteria=e.sortCriteria,this.withSearch=e.withSearch,this.validateProps();const t={label:()=>this.bindings.i18n.t(this.label),facetId:this.facetId,element:this.host,isHidden:()=>this.isHidden};this.bindings.store.registerFacet("facets",t),n(this.host,{...t,hasValues:()=>!!this.facet.state.values.length,numberOfSelectedValues:()=>this.numberOfSelectedValues})}validateProps(){new e({displayValuesAs:new t({constrainTo:["checkbox","link","box"]})}).validate({displayValuesAs:this.displayValuesAs}),L(this.dependsOn)}disconnectedCallback(){var e;this.host.isConnected||null===(e=this.dependenciesManager)||void 0===e||e.stopWatching()}get isHidden(){return!this.facet.state.enabled||!this.facet.state.values.length}componentShouldUpdate(e,t,s){return"facetState"!==s||!t||!this.withSearch||o(e,t)}renderHeader(e,t,a){return s(c,{i18n:this.bindings.i18n,label:this.label,onClearFilters:()=>{e.focusAfterSearch(),this.facet.deselectAll()},numberOfSelectedValues:this.numberOfSelectedValues,isCollapsed:t,headingLevel:this.headingLevel,onToggleCollapse:a,headerRef:t=>e.setTarget(t)})}get numberOfSelectedValues(){return this.facet.state.values.filter((({state:e})=>"selected"===e)).length}renderSearchInput(){if(this.withSearch)return s(w,{i18n:this.bindings.i18n,label:this.label,query:this.facet.state.facetSearch.query,onChange:e=>{""!==e?(this.facet.facetSearch.updateCaptions(r(this.field,this.bindings.i18n)),this.facet.facetSearch.updateText(e),this.facet.facetSearch.search()):this.facet.facetSearch.clear()},onClear:()=>this.facet.facetSearch.clear()})}renderMatches(){return s(g,{i18n:this.bindings.i18n,query:this.facet.state.facetSearch.query,numberOfMatches:this.facet.state.facetSearch.values.length,hasMoreMatches:this.facet.state.facetSearch.moreValuesAvailable})}renderValuesContainer(e,t){const a="mt-3 "+("box"===this.displayValuesAs?"box-container":"");return s(u,{i18n:this.bindings.i18n,label:this.label,query:t},s("ul",{class:a,part:"values"},e))}renderSearchResults(e,t){return this.renderValuesContainer(this.facet.state.facetSearch.values.map((s=>this.renderValue({state:"idle",numberOfResults:s.count,value:s.rawValue},(()=>"link"===this.displayValuesAs?this.facet.facetSearch.singleSelect(s):this.facet.facetSearch.select(s)),!1,!1,e,t))),this.facet.state.facetSearch.query)}renderValues(e,t){return this.renderValuesContainer(this.facet.state.values.map(((s,a)=>this.renderValue(s,(()=>"link"===this.displayValuesAs?this.facet.toggleSingleSelect(s):this.facet.toggleSelect(s)),0===a,a===("automatic"===this.sortCriteria?0:this.resultIndexToFocusOnShowMore),e,t))))}renderValue(e,t,r,n,i,l){const c=a(this.field,e.value,this.bindings.i18n),u="selected"===e.state;switch(this.displayValuesAs){case"checkbox":return s(f,{displayValue:c,numberOfResults:e.numberOfResults,isSelected:u,i18n:this.bindings.i18n,onClick:t,searchQuery:this.facet.state.facetSearch.query,buttonRef:e=>{r&&i.setTarget(e),n&&l.setTarget(e)}},s(h,{displayValue:c,isSelected:u,searchQuery:this.facet.state.facetSearch.query}));case"link":return s(O,{displayValue:c,numberOfResults:e.numberOfResults,isSelected:u,i18n:this.bindings.i18n,onClick:t,searchQuery:this.facet.state.facetSearch.query,buttonRef:e=>{r&&i.setTarget(e),n&&l.setTarget(e)}},s(h,{displayValue:c,isSelected:u,searchQuery:this.facet.state.facetSearch.query}));case"box":return s(C,{displayValue:c,numberOfResults:e.numberOfResults,isSelected:u,i18n:this.bindings.i18n,onClick:t,searchQuery:this.facet.state.facetSearch.query,buttonRef:e=>{r&&i.setTarget(e),n&&l.setTarget(e)}},s(h,{displayValue:c,isSelected:u,searchQuery:this.facet.state.facetSearch.query}))}}renderShowMoreLess(e,t){return s(S,{label:this.label,i18n:this.bindings.i18n,onShowMore:()=>{this.resultIndexToFocusOnShowMore=this.facet.state.values.length,t.focusAfterSearch(),this.facet.showMoreValues()},onShowLess:()=>{e.focusAfterSearch(),this.facet.showLessValues()},canShowMoreValues:this.facet.state.canShowMoreValues,canShowLessValues:this.facet.state.canShowLessValues})}renderBody(e,t){return[this.renderSearchInput(),p(this.facet.state.facetSearch)?[this.renderSearchResults(e,t),this.renderMatches()]:[this.renderValues(e,t),this.renderShowMoreLess(e,t)]]}render({hasError:e,firstSearchExecuted:t,isCollapsed:a,numberOfValues:r,headerFocus:n,showLessFocus:l,showMoreFocus:c,onToggleCollapse:u}){return e||!this.facet.state.enabled?s(i,null):t?this.facet.state.values.length?s(m,null,this.renderHeader(n,a,u),!a&&this.renderBody(l,c)):s(i,null):s(d,{numberOfValues:r,isCollapsed:a})}}export{O as F,S as a,w as b,g as c,C as d,B as e,F as f,Q as g,q as h,T as i,A as j,I as p,E as s,L as v};