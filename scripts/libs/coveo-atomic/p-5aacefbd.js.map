{"version":3,"names":["ResultChildrenCommon","constructor","props","this","foldedResult","collection","getResult","numberOfChildren","children","length","hasChildren","getFoldedResultListState","results","find","r","result","uniqueId","renderPlaceholder","h","ResultsPlaceholder","numberOfPlaceholders","density","getDisplayConfig","imageSize","getImageSize","renderNoResult","part","class","getBindings","i18n","t","getNoResultText","renderCollapseButton","moreResultsAvailable","Button","style","onClick","getShowInitialChildren","getFoldedResultList","logShowMoreFoldedResults","logShowLessFoldedResults","toggleShowInitialChildren","renderChildrenWrapper","content","name","renderChildren","map","child","i","renderChild","renderCollection","isLoadingMoreResults","_a","trim","childrenToRender","getInitialChildren","Host","renderFoldedResult","componentWillRender","setInitialChildren","render","getInheritTemplates","getResultTemplateRegistered","getTemplateHasError"],"sources":["src/components/common/result-children/result-children-common.tsx"],"sourcesContent":["import {\n  FoldedResult,\n  FoldedResultList,\n  FoldedResultListState,\n} from '@coveo/headless';\nimport {Host, VNode, h} from '@stencil/core';\nimport {DisplayConfig} from '../../search/result-template-components/result-template-decorators';\nimport {ResultsPlaceholder} from '../atomic-result-placeholder/placeholders';\nimport {Button} from '../button';\nimport {AnyBindings} from '../interface/bindings';\nimport {ResultDisplayImageSize} from '../layout/display-options';\n\ninterface ResultChildrenProps {\n  getHost: () => HTMLElement;\n  getBindings: () => AnyBindings;\n  getFoldedResultListState: () => FoldedResultListState;\n  getResult: () => FoldedResult;\n  getShowInitialChildren: () => boolean;\n  getFoldedResultList: () => FoldedResultList;\n  getInitialChildren: () => FoldedResult[];\n  getInheritTemplates: () => boolean;\n  getResultTemplateRegistered: () => boolean;\n  getTemplateHasError: () => boolean;\n  getNoResultText: () => string;\n  getDisplayConfig: () => DisplayConfig;\n  getImageSize: () => ResultDisplayImageSize | undefined;\n  renderChild: (child: FoldedResult, isLast: boolean) => VNode;\n  setInitialChildren: (initialChildren: FoldedResult[]) => void;\n  toggleShowInitialChildren: () => void;\n}\n\nexport class ResultChildrenCommon {\n  constructor(private props: ResultChildrenProps) {}\n\n  private get foldedResult(): FoldedResult {\n    return this.collection || this.props.getResult();\n  }\n\n  private get numberOfChildren() {\n    return this.foldedResult.children.length;\n  }\n\n  private get hasChildren() {\n    return !!this.numberOfChildren;\n  }\n\n  private get collection() {\n    return this.props.getFoldedResultListState().results.find((r) => {\n      return r.result.uniqueId === this.props.getResult().result.uniqueId;\n    });\n  }\n\n  private renderPlaceholder() {\n    return (\n      <ResultsPlaceholder\n        numberOfPlaceholders={this.numberOfChildren || 2}\n        density={this.props.getDisplayConfig().density}\n        imageSize={\n          this.props.getImageSize() || this.props.getDisplayConfig().imageSize\n        }\n      />\n    );\n  }\n\n  private renderNoResult() {\n    return (\n      <p part=\"no-result-root\" class=\"no-result-root my-3\">\n        {this.props.getBindings().i18n.t(this.props.getNoResultText())}\n      </p>\n    );\n  }\n\n  private renderCollapseButton() {\n    const collection = this.collection!;\n    if (!!collection.children.length && !collection.moreResultsAvailable) {\n      return (\n        <Button\n          part=\"show-hide-button\"\n          class=\"show-hide-button\"\n          style=\"text-primary\"\n          onClick={() => {\n            if (this.props.getShowInitialChildren()) {\n              this.props\n                .getFoldedResultList()\n                .logShowMoreFoldedResults(this.foldedResult.result);\n            } else {\n              this.props.getFoldedResultList().logShowLessFoldedResults();\n            }\n            this.props.toggleShowInitialChildren();\n          }}\n        >\n          {this.props\n            .getBindings()\n            .i18n.t(\n              this.props.getShowInitialChildren()\n                ? 'load-all-results'\n                : 'collapse-results'\n            )}\n        </Button>\n      );\n    }\n    return;\n  }\n\n  private renderChildrenWrapper(content: VNode | VNode[]) {\n    return (\n      <div part=\"children-root\">\n        {this.hasChildren && <slot name=\"before-children\"></slot>}\n        {content}\n        {this.hasChildren && <slot name=\"after-children\"></slot>}\n      </div>\n    );\n  }\n\n  private renderChildren(children: FoldedResult[]): VNode | VNode[] {\n    return this.renderChildrenWrapper(\n      children.map((child, i) =>\n        this.props.renderChild(child, i === children.length - 1)\n      )\n    );\n  }\n\n  private renderCollection() {\n    const collection = this.collection!;\n\n    if (collection.isLoadingMoreResults) {\n      return this.renderChildrenWrapper(this.renderPlaceholder());\n    }\n\n    if (!collection.moreResultsAvailable && !this.hasChildren) {\n      return this.props.getNoResultText()?.trim().length\n        ? this.renderNoResult()\n        : null;\n    }\n\n    if (!this.hasChildren) {\n      return;\n    }\n\n    const childrenToRender = this.props.getShowInitialChildren()\n      ? this.props.getInitialChildren()\n      : collection.children;\n\n    return (\n      <Host>\n        {this.renderCollapseButton()}\n        {this.renderChildren(childrenToRender)}\n      </Host>\n    );\n  }\n\n  private renderFoldedResult() {\n    if (!this.hasChildren) {\n      return;\n    }\n\n    return this.renderChildren(this.foldedResult.children);\n  }\n\n  public componentWillRender() {\n    const collection = this.collection;\n    if (this.props.getInitialChildren() || !collection) {\n      return;\n    }\n\n    this.props.setInitialChildren(collection.children);\n  }\n\n  public render() {\n    if (\n      !this.props.getInheritTemplates() &&\n      !this.props.getResultTemplateRegistered()\n    ) {\n      return;\n    }\n\n    if (!this.props.getInheritTemplates() && this.props.getTemplateHasError()) {\n      return <slot></slot>;\n    }\n\n    return this.collection\n      ? this.renderCollection()\n      : this.renderFoldedResult();\n  }\n}\n"],"mappings":"yHA+BaA,EACX,WAAAC,CAAoBC,GAAAC,KAAAD,O,CAEpB,gBAAYE,GACV,OAAOD,KAAKE,YAAcF,KAAKD,MAAMI,W,CAGvC,oBAAYC,GACV,OAAOJ,KAAKC,aAAaI,SAASC,M,CAGpC,eAAYC,GACV,QAASP,KAAKI,gB,CAGhB,cAAYF,GACV,OAAOF,KAAKD,MAAMS,2BAA2BC,QAAQC,MAAMC,GAClDA,EAAEC,OAAOC,WAAab,KAAKD,MAAMI,YAAYS,OAAOC,U,CAIvD,iBAAAC,GACN,OACEC,EAACC,EAAkB,CACjBC,qBAAsBjB,KAAKI,kBAAoB,EAC/Cc,QAASlB,KAAKD,MAAMoB,mBAAmBD,QACvCE,UACEpB,KAAKD,MAAMsB,gBAAkBrB,KAAKD,MAAMoB,mBAAmBC,W,CAM3D,cAAAE,GACN,OACEP,EAAA,KAAGQ,KAAK,iBAAiBC,MAAM,uBAC5BxB,KAAKD,MAAM0B,cAAcC,KAAKC,EAAE3B,KAAKD,MAAM6B,mB,CAK1C,oBAAAC,GACN,MAAM3B,EAAaF,KAAKE,WACxB,KAAMA,EAAWG,SAASC,SAAWJ,EAAW4B,qBAAsB,CACpE,OACEf,EAACgB,EAAM,CACLR,KAAK,mBACLC,MAAM,mBACNQ,MAAM,eACNC,QAAS,KACP,GAAIjC,KAAKD,MAAMmC,yBAA0B,CACvClC,KAAKD,MACFoC,sBACAC,yBAAyBpC,KAAKC,aAAaW,O,KACzC,CACLZ,KAAKD,MAAMoC,sBAAsBE,0B,CAEnCrC,KAAKD,MAAMuC,2BAA2B,GAGvCtC,KAAKD,MACH0B,cACAC,KAAKC,EACJ3B,KAAKD,MAAMmC,yBACP,mBACA,oB,CAKd,M,CAGM,qBAAAK,CAAsBC,GAC5B,OACEzB,EAAA,OAAKQ,KAAK,iBACPvB,KAAKO,aAAeQ,EAAA,QAAM0B,KAAK,oBAC/BD,EACAxC,KAAKO,aAAeQ,EAAA,QAAM0B,KAAK,mB,CAK9B,cAAAC,CAAerC,GACrB,OAAOL,KAAKuC,sBACVlC,EAASsC,KAAI,CAACC,EAAOC,IACnB7C,KAAKD,MAAM+C,YAAYF,EAAOC,IAAMxC,EAASC,OAAS,K,CAKpD,gBAAAyC,G,MACN,MAAM7C,EAAaF,KAAKE,WAExB,GAAIA,EAAW8C,qBAAsB,CACnC,OAAOhD,KAAKuC,sBAAsBvC,KAAKc,oB,CAGzC,IAAKZ,EAAW4B,uBAAyB9B,KAAKO,YAAa,CACzD,QAAO0C,EAAAjD,KAAKD,MAAM6B,qBAAiB,MAAAqB,SAAA,SAAAA,EAAEC,OAAO5C,QACxCN,KAAKsB,iBACL,I,CAGN,IAAKtB,KAAKO,YAAa,CACrB,M,CAGF,MAAM4C,EAAmBnD,KAAKD,MAAMmC,yBAChClC,KAAKD,MAAMqD,qBACXlD,EAAWG,SAEf,OACEU,EAACsC,EAAI,KACFrD,KAAK6B,uBACL7B,KAAK0C,eAAeS,G,CAKnB,kBAAAG,GACN,IAAKtD,KAAKO,YAAa,CACrB,M,CAGF,OAAOP,KAAK0C,eAAe1C,KAAKC,aAAaI,S,CAGxC,mBAAAkD,GACL,MAAMrD,EAAaF,KAAKE,WACxB,GAAIF,KAAKD,MAAMqD,uBAAyBlD,EAAY,CAClD,M,CAGFF,KAAKD,MAAMyD,mBAAmBtD,EAAWG,S,CAGpC,MAAAoD,GACL,IACGzD,KAAKD,MAAM2D,wBACX1D,KAAKD,MAAM4D,8BACZ,CACA,M,CAGF,IAAK3D,KAAKD,MAAM2D,uBAAyB1D,KAAKD,MAAM6D,sBAAuB,CACzE,OAAO7C,EAAA,Y,CAGT,OAAOf,KAAKE,WACRF,KAAK+C,mBACL/C,KAAKsD,oB"}